<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Prod Clone</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg-color: #1e1e1e;
            --card-bg: #2d2d2d;
            --accent: #0dd1a7; /* Super Prod Green */
            --text: #ffffff;
            --text-muted: #aaaaaa;
            --danger: #ff5252;
            --border: #3e3e3e;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }

        body {
            background-color: var(--bg-color);
            color: var(--text);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        header {
            padding: 1rem 2rem;
            background: #252526;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 { font-size: 1.2rem; font-weight: 500; display: flex; align-items: center; gap: 10px; }
        .global-timer { font-family: monospace; font-size: 1.2rem; color: var(--accent); }

        /* Board Layout */
        .board {
            flex: 1;
            display: flex;
            padding: 20px;
            gap: 20px;
            overflow-x: auto;
        }

        .column {
            background: #252526;
            min-width: 300px;
            max-width: 300px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border);
        }

        .column-header {
            padding: 15px;
            font-weight: 600;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-list {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            min-height: 100px;
        }

        /* Task Card */
        .task-card {
            background: var(--card-bg);
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 10px;
            cursor: grab;
            border: 1px solid transparent;
            transition: all 0.2s;
            position: relative;
        }

        .task-card:hover { border-color: #555; }
        .task-card.dragging { opacity: 0.5; border: 1px dashed var(--text-muted); }

        .task-title { margin-bottom: 8px; font-size: 0.95rem; line-height: 1.4; }
        
        .task-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid #3e3e3e;
        }

        .timer-display { font-family: monospace; font-size: 0.9rem; color: var(--text-muted); }
        .active-timer { color: var(--accent); font-weight: bold; }

        .btn-icon {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            transition: color 0.2s;
        }
        .btn-icon:hover { color: var(--text); }
        .btn-play:hover { color: var(--accent); }
        .btn-delete:hover { color: var(--danger); }

        /* Add Task Input */
        .add-task-container {
            padding: 10px;
            border-top: 1px solid var(--border);
        }

        input[type="text"] {
            width: 100%;
            background: #1e1e1e;
            border: 1px solid var(--border);
            color: white;
            padding: 8px;
            border-radius: 4px;
            outline: none;
        }
        input[type="text"]:focus { border-color: var(--accent); }

    </style>
</head>
<body>

    <header>
        <h1><i class="fa-solid fa-check-double" style="color:var(--accent)"></i> My Tasks</h1>
        <div class="global-timer">Total: <span id="global-time">00:00:00</span></div>
    </header>

    <div class="board" id="board">
        </div>

    <script>
        // --- STATE MANAGEMENT ---
        const COLUMNS = ['To Do', 'In Progress', 'Done'];
        let tasks = JSON.parse(localStorage.getItem('super_prod_tasks')) || [];
        let activeTaskId = null;
        let timerInterval = null;

        // --- DOM ELEMENTS ---
        const boardEl = document.getElementById('board');
        const globalTimeEl = document.getElementById('global-time');

        // --- INITIALIZATION ---
        function init() {
            renderBoard();
            // Resume timer if page was closed while running (simple logic: just stop it on load to prevent drift)
            // In a real app, you'd calculate the diff. For this simple version, we reset the active state.
            if(activeTaskId) toggleTimer(activeTaskId); 
            updateGlobalTime();
        }

        // --- RENDERING ---
        function renderBoard() {
            boardEl.innerHTML = '';
            
            COLUMNS.forEach(colName => {
                const colId = colName.toLowerCase().replace(' ', '-');
                
                const colDiv = document.createElement('div');
                colDiv.className = 'column';
                colDiv.innerHTML = `
                    <div class="column-header">
                        ${colName}
                        <span style="font-size:0.8rem; color: #666">${tasks.filter(t => t.status === colId).length}</span>
                    </div>
                    <div class="task-list" id="${colId}" ondrop="drop(event)" ondragover="allowDrop(event)">
                        </div>
                    <div class="add-task-container">
                        <input type="text" placeholder="+ Add task" onkeydown="handleEnter(event, '${colId}')">
                    </div>
                `;

                const list = colDiv.querySelector('.task-list');
                const colTasks = tasks.filter(t => t.status === colId);

                colTasks.forEach(task => {
                    list.appendChild(createTaskElement(task));
                });

                boardEl.appendChild(colDiv);
            });
        }

        function createTaskElement(task) {
            const el = document.createElement('div');
            el.className = 'task-card';
            el.draggable = true;
            el.id = task.id;
            
            // Drag Events
            el.addEventListener('dragstart', drag);

            const isRunning = activeTaskId === task.id;
            const playIcon = isRunning ? 'fa-pause' : 'fa-play';
            const timeClass = isRunning ? 'timer-display active-timer' : 'timer-display';

            el.innerHTML = `
                <div class="task-title" contenteditable="true" onblur="updateTitle('${task.id}', this.innerText)">${task.title}</div>
                <div class="task-controls">
                    <span class="${timeClass}" id="time-${task.id}">${formatTime(task.timeSpent)}</span>
                    <div>
                        <button class="btn-icon btn-play" onclick="toggleTimer('${task.id}')">
                            <i class="fa-solid ${playIcon}"></i>
                        </button>
                        <button class="btn-icon btn-delete" onclick="deleteTask('${task.id}')">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            return el;
        }

        // --- LOGIC ---

        function handleEnter(e, status) {
            if (e.key === 'Enter' && e.target.value.trim() !== "") {
                addTask(e.target.value, status);
                e.target.value = '';
            }
        }

        function addTask(title, status) {
            const newTask = {
                id: 'task-' + Date.now(),
                title: title,
                status: status,
                timeSpent: 0,
                createdAt: Date.now()
            };
            tasks.push(newTask);
            saveAndRender();
        }

        function updateTitle(id, newTitle) {
            const task = tasks.find(t => t.id === id);
            if(task) {
                task.title = newTitle;
                saveData(); // Don't re-render, just save
            }
        }

        function deleteTask(id) {
            if(activeTaskId === id) stopTimer();
            tasks = tasks.filter(t => t.id !== id);
            saveAndRender();
        }

        function toggleTimer(id) {
            if (activeTaskId === id) {
                // Stop current
                stopTimer();
            } else {
                // Stop previous if exists
                if (activeTaskId) stopTimer();
                // Start new
                activeTaskId = id;
                renderBoard(); // Update icons
                timerInterval = setInterval(() => {
                    const task = tasks.find(t => t.id === activeTaskId);
                    if(task) {
                        task.timeSpent += 1000;
                        document.getElementById(`time-${task.id}`).innerText = formatTime(task.timeSpent);
                        updateGlobalTime();
                        saveData(); // Save continuously
                    }
                }, 1000);
            }
        }

        function stopTimer() {
            clearInterval(timerInterval);
            activeTaskId = null;
            renderBoard();
        }

        function updateGlobalTime() {
            const total = tasks.reduce((acc, curr) => acc + curr.timeSpent, 0);
            globalTimeEl.innerText = formatTime(total);
        }

        function formatTime(ms) {
            const seconds = Math.floor((ms / 1000) % 60);
            const minutes = Math.floor((ms / (1000 * 60)) % 60);
            const hours = Math.floor((ms / (1000 * 60 * 60)));

            const pad = (num) => num.toString().padStart(2, '0');
            return `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
        }

        function saveAndRender() {
            saveData();
            renderBoard();
        }

        function saveData() {
            localStorage.setItem('super_prod_tasks', JSON.stringify(tasks));
        }

        // --- DRAG AND DROP ---
        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
            ev.target.classList.add('dragging');
        }

        function allowDrop(ev) {
            ev.preventDefault();
        }

        function drop(ev) {
            ev.preventDefault();
            const taskId = ev.dataTransfer.getData("text");
            const dropTarget = ev.target.closest('.task-list'); // Ensure we drop into the list container
            
            if (dropTarget) {
                const newStatus = dropTarget.id;
                const task = tasks.find(t => t.id === taskId);
                
                if(task && task.status !== newStatus) {
                    task.status = newStatus;
                    saveAndRender();
                }
            }
        }

        init();
    </script>
</body>
</html>
